// Code generated by protoc-gen-leo-http. DO NOT EDIT.

package helloworld

import (
	context "context"
	endpoint "github.com/go-kit/kit/endpoint"
	"github.com/go-kit/kit/sd"
	"github.com/go-kit/kit/transport/http"
	"github.com/go-kit/log"
	endpointx "github.com/go-leo/leo/v3/endpointx"
	"github.com/go-leo/leo/v3/sdx"
	"github.com/go-leo/leo/v3/sdx/lbx"
	statusx "github.com/go-leo/leo/v3/statusx"
	transportx "github.com/go-leo/leo/v3/transportx"
	httpx "github.com/go-leo/leo/v3/transportx/httpx"
)

type greeterHttpClientV2 struct {
	balancers GreeterBalancers
}

func (c *greeterHttpClientV2) SayHello(ctx context.Context, request *HelloRequest) (*HelloReply, error) {
	ctx = endpointx.InjectName(ctx, "/helloworld.Greeter/SayHello")
	ctx = transportx.InjectName(ctx, httpx.HttpClient)
	balancer, err := c.balancers.SayHello(ctx)
	if err != nil {
		return nil, err
	}
	endpoint, err := balancer.Endpoint()
	if err != nil {
		return nil, err
	}
	rep, err := endpoint(ctx, request)
	if err != nil {
		return nil, statusx.From(err)
	}
	return rep.(*HelloReply), nil
}

func NewGreeterHttpClientV2(
	scheme string,
	target string,
	clientOptions []http.ClientOption,
	middlewares []endpoint.Middleware,
	instancerFactory sdx.InstancerFactory,
	EndpointerOptions []sd.EndpointerOption,
	log log.Logger,
	factory lbx.BalancerFactory,
) (GreeterService, error) {
	transportsV2 := newGreeterHttpClientTransports(scheme, clientOptions, middlewares)
	factories := newGreeterFactories(transportsV2)
	endpointers := newGreeterEndpointers(target, instancerFactory, factories, log, EndpointerOptions...)
	balancers := newGreeterBalancers(factory, endpointers)
	return &greeterHttpClientV2{balancers: balancers}, nil
}
