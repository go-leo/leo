// Code generated by protoc-gen-leo-core. DO NOT EDIT.

package cqrs

import (
	context "context"
	endpoint "github.com/go-kit/kit/endpoint"
	sd "github.com/go-kit/kit/sd"
	lb "github.com/go-kit/kit/sd/lb"
	log "github.com/go-kit/log"
	lazyloadx "github.com/go-leo/gox/syncx/lazyloadx"
	endpointx "github.com/go-leo/leo/v3/endpointx"
	sdx "github.com/go-leo/leo/v3/sdx"
	lbx "github.com/go-leo/leo/v3/sdx/lbx"
	stainx "github.com/go-leo/leo/v3/sdx/stainx"
	statusx "github.com/go-leo/leo/v3/statusx"
	transportx "github.com/go-leo/leo/v3/transportx"
	emptypb "google.golang.org/protobuf/types/known/emptypb"
	io "io"
)

// CQRSService is a service
type CQRSService interface {
	CreateUser(ctx context.Context, request *CreateUserRequest) (*emptypb.Empty, error)
	DeleteUser(ctx context.Context, request *DeleteUserRequest) (*DeleteUserResponse, error)
	UpdateUser(ctx context.Context, request *UpdateUserRequest) (*UpdateUserResponse, error)
	FindUser(ctx context.Context, request *FindUserRequest) (*GetUserResponse, error)
}

// CQRSServerEndpoints is server endpoints
type CQRSServerEndpoints interface {
	CreateUser(ctx context.Context) endpoint.Endpoint
	DeleteUser(ctx context.Context) endpoint.Endpoint
	UpdateUser(ctx context.Context) endpoint.Endpoint
	FindUser(ctx context.Context) endpoint.Endpoint
}

// CQRSClientEndpoints is client endpoints
type CQRSClientEndpoints interface {
	CreateUser(ctx context.Context) (endpoint.Endpoint, error)
	DeleteUser(ctx context.Context) (endpoint.Endpoint, error)
	UpdateUser(ctx context.Context) (endpoint.Endpoint, error)
	FindUser(ctx context.Context) (endpoint.Endpoint, error)
}

// CQRSClientTransports is client transports
type CQRSClientTransports interface {
	CreateUser(ctx context.Context, instance string) (endpoint.Endpoint, io.Closer, error)
	DeleteUser(ctx context.Context, instance string) (endpoint.Endpoint, io.Closer, error)
	UpdateUser(ctx context.Context, instance string) (endpoint.Endpoint, io.Closer, error)
	FindUser(ctx context.Context, instance string) (endpoint.Endpoint, io.Closer, error)
}

// CQRSFactories is client factories
type CQRSFactories interface {
	CreateUser(ctx context.Context) sd.Factory
	DeleteUser(ctx context.Context) sd.Factory
	UpdateUser(ctx context.Context) sd.Factory
	FindUser(ctx context.Context) sd.Factory
}

// CQRSEndpointers is client endpointers
type CQRSEndpointers interface {
	CreateUser(ctx context.Context, color string) (sd.Endpointer, error)
	DeleteUser(ctx context.Context, color string) (sd.Endpointer, error)
	UpdateUser(ctx context.Context, color string) (sd.Endpointer, error)
	FindUser(ctx context.Context, color string) (sd.Endpointer, error)
}

// CQRSBalancers is client balancers
type CQRSBalancers interface {
	CreateUser(ctx context.Context) (lb.Balancer, error)
	DeleteUser(ctx context.Context) (lb.Balancer, error)
	UpdateUser(ctx context.Context) (lb.Balancer, error)
	FindUser(ctx context.Context) (lb.Balancer, error)
}

// cQRSServerEndpoints implements CQRSServerEndpoints
type cQRSServerEndpoints struct {
	svc         CQRSService
	middlewares []endpoint.Middleware
}

func (e *cQRSServerEndpoints) CreateUser(context.Context) endpoint.Endpoint {
	component := func(ctx context.Context, request any) (any, error) {
		return e.svc.CreateUser(ctx, request.(*CreateUserRequest))
	}
	return endpointx.Chain(component, e.middlewares...)
}
func (e *cQRSServerEndpoints) DeleteUser(context.Context) endpoint.Endpoint {
	component := func(ctx context.Context, request any) (any, error) {
		return e.svc.DeleteUser(ctx, request.(*DeleteUserRequest))
	}
	return endpointx.Chain(component, e.middlewares...)
}
func (e *cQRSServerEndpoints) UpdateUser(context.Context) endpoint.Endpoint {
	component := func(ctx context.Context, request any) (any, error) {
		return e.svc.UpdateUser(ctx, request.(*UpdateUserRequest))
	}
	return endpointx.Chain(component, e.middlewares...)
}
func (e *cQRSServerEndpoints) FindUser(context.Context) endpoint.Endpoint {
	component := func(ctx context.Context, request any) (any, error) {
		return e.svc.FindUser(ctx, request.(*FindUserRequest))
	}
	return endpointx.Chain(component, e.middlewares...)
}
func newCQRSServerEndpoints(svc CQRSService, middlewares ...endpoint.Middleware) CQRSServerEndpoints {
	return &cQRSServerEndpoints{svc: svc, middlewares: middlewares}
}

// cQRSClientEndpoints implements CQRSClientEndpoints
type cQRSClientEndpoints struct {
	balancers CQRSBalancers
}

func (e *cQRSClientEndpoints) CreateUser(ctx context.Context) (endpoint.Endpoint, error) {
	balancer, err := e.balancers.CreateUser(ctx)
	if err != nil {
		return nil, err
	}
	return balancer.Endpoint()
}
func (e *cQRSClientEndpoints) DeleteUser(ctx context.Context) (endpoint.Endpoint, error) {
	balancer, err := e.balancers.DeleteUser(ctx)
	if err != nil {
		return nil, err
	}
	return balancer.Endpoint()
}
func (e *cQRSClientEndpoints) UpdateUser(ctx context.Context) (endpoint.Endpoint, error) {
	balancer, err := e.balancers.UpdateUser(ctx)
	if err != nil {
		return nil, err
	}
	return balancer.Endpoint()
}
func (e *cQRSClientEndpoints) FindUser(ctx context.Context) (endpoint.Endpoint, error) {
	balancer, err := e.balancers.FindUser(ctx)
	if err != nil {
		return nil, err
	}
	return balancer.Endpoint()
}
func newCQRSClientEndpoints(
	target string,
	transports CQRSClientTransports,
	builder sdx.Builder,
	endpointerOptions []sd.EndpointerOption,
	balancerFactory lbx.BalancerFactory,
	logger log.Logger,
) CQRSClientEndpoints {
	factories := newCQRSFactories(transports)
	endpointers := newCQRSEndpointers(target, builder, factories, logger, endpointerOptions...)
	balancers := newCQRSBalancers(balancerFactory, endpointers)
	return &cQRSClientEndpoints{balancers: balancers}
}

// cQRSFactories implements CQRSFactories
type cQRSFactories struct {
	transports CQRSClientTransports
}

func (f *cQRSFactories) CreateUser(ctx context.Context) sd.Factory {
	return func(instance string) (endpoint.Endpoint, io.Closer, error) {
		return f.transports.CreateUser(ctx, instance)
	}
}
func (f *cQRSFactories) DeleteUser(ctx context.Context) sd.Factory {
	return func(instance string) (endpoint.Endpoint, io.Closer, error) {
		return f.transports.DeleteUser(ctx, instance)
	}
}
func (f *cQRSFactories) UpdateUser(ctx context.Context) sd.Factory {
	return func(instance string) (endpoint.Endpoint, io.Closer, error) {
		return f.transports.UpdateUser(ctx, instance)
	}
}
func (f *cQRSFactories) FindUser(ctx context.Context) sd.Factory {
	return func(instance string) (endpoint.Endpoint, io.Closer, error) {
		return f.transports.FindUser(ctx, instance)
	}
}
func newCQRSFactories(transports CQRSClientTransports) CQRSFactories {
	return &cQRSFactories{transports: transports}
}

// cQRSEndpointers implements CQRSEndpointers
type cQRSEndpointers struct {
	target    string
	builder   sdx.Builder
	factories CQRSFactories
	logger    log.Logger
	options   []sd.EndpointerOption
}

func (e *cQRSEndpointers) CreateUser(ctx context.Context, color string) (sd.Endpointer, error) {
	return sdx.NewEndpointer(ctx, e.target, color, e.builder, e.factories.CreateUser(ctx), e.logger, e.options...)
}
func (e *cQRSEndpointers) DeleteUser(ctx context.Context, color string) (sd.Endpointer, error) {
	return sdx.NewEndpointer(ctx, e.target, color, e.builder, e.factories.DeleteUser(ctx), e.logger, e.options...)
}
func (e *cQRSEndpointers) UpdateUser(ctx context.Context, color string) (sd.Endpointer, error) {
	return sdx.NewEndpointer(ctx, e.target, color, e.builder, e.factories.UpdateUser(ctx), e.logger, e.options...)
}
func (e *cQRSEndpointers) FindUser(ctx context.Context, color string) (sd.Endpointer, error) {
	return sdx.NewEndpointer(ctx, e.target, color, e.builder, e.factories.FindUser(ctx), e.logger, e.options...)
}
func newCQRSEndpointers(
	target string,
	builder sdx.Builder,
	factories CQRSFactories,
	logger log.Logger,
	options ...sd.EndpointerOption,
) CQRSEndpointers {
	return &cQRSEndpointers{
		target:    target,
		builder:   builder,
		factories: factories,
		logger:    logger,
		options:   options,
	}
}

// cQRSBalancers implements CQRSBalancers
type cQRSBalancers struct {
	factory    lbx.BalancerFactory
	endpointer CQRSEndpointers
	createUser lazyloadx.Group[lb.Balancer]
	deleteUser lazyloadx.Group[lb.Balancer]
	updateUser lazyloadx.Group[lb.Balancer]
	findUser   lazyloadx.Group[lb.Balancer]
}

func (b *cQRSBalancers) CreateUser(ctx context.Context) (lb.Balancer, error) {
	color, _ := stainx.ExtractColor(ctx)
	balancer, err, _ := b.createUser.LoadOrNew(color, lbx.NewBalancer(ctx, b.factory, b.endpointer.CreateUser))
	return balancer, err
}
func (b *cQRSBalancers) DeleteUser(ctx context.Context) (lb.Balancer, error) {
	color, _ := stainx.ExtractColor(ctx)
	balancer, err, _ := b.deleteUser.LoadOrNew(color, lbx.NewBalancer(ctx, b.factory, b.endpointer.DeleteUser))
	return balancer, err
}
func (b *cQRSBalancers) UpdateUser(ctx context.Context) (lb.Balancer, error) {
	color, _ := stainx.ExtractColor(ctx)
	balancer, err, _ := b.updateUser.LoadOrNew(color, lbx.NewBalancer(ctx, b.factory, b.endpointer.UpdateUser))
	return balancer, err
}
func (b *cQRSBalancers) FindUser(ctx context.Context) (lb.Balancer, error) {
	color, _ := stainx.ExtractColor(ctx)
	balancer, err, _ := b.findUser.LoadOrNew(color, lbx.NewBalancer(ctx, b.factory, b.endpointer.FindUser))
	return balancer, err
}
func newCQRSBalancers(factory lbx.BalancerFactory, endpointer CQRSEndpointers) CQRSBalancers {
	return &cQRSBalancers{
		factory:    factory,
		endpointer: endpointer,
		createUser: lazyloadx.Group[lb.Balancer]{},
		deleteUser: lazyloadx.Group[lb.Balancer]{},
		updateUser: lazyloadx.Group[lb.Balancer]{},
		findUser:   lazyloadx.Group[lb.Balancer]{},
	}
}

// cQRSClientService implements CQRSClientService
type cQRSClientService struct {
	endpoints     CQRSClientEndpoints
	transportName string
}

func (c *cQRSClientService) CreateUser(ctx context.Context, request *CreateUserRequest) (*emptypb.Empty, error) {
	ctx = endpointx.InjectName(ctx, "/pb.CQRS/CreateUser")
	ctx = transportx.InjectName(ctx, c.transportName)
	endpoint, err := c.endpoints.CreateUser(ctx)
	if err != nil {
		return nil, err
	}
	rep, err := endpoint(ctx, request)
	if err != nil {
		return nil, statusx.From(err)
	}
	return rep.(*emptypb.Empty), nil
}
func (c *cQRSClientService) DeleteUser(ctx context.Context, request *DeleteUserRequest) (*DeleteUserResponse, error) {
	ctx = endpointx.InjectName(ctx, "/pb.CQRS/DeleteUser")
	ctx = transportx.InjectName(ctx, c.transportName)
	endpoint, err := c.endpoints.DeleteUser(ctx)
	if err != nil {
		return nil, err
	}
	rep, err := endpoint(ctx, request)
	if err != nil {
		return nil, statusx.From(err)
	}
	return rep.(*DeleteUserResponse), nil
}
func (c *cQRSClientService) UpdateUser(ctx context.Context, request *UpdateUserRequest) (*UpdateUserResponse, error) {
	ctx = endpointx.InjectName(ctx, "/pb.CQRS/UpdateUser")
	ctx = transportx.InjectName(ctx, c.transportName)
	endpoint, err := c.endpoints.UpdateUser(ctx)
	if err != nil {
		return nil, err
	}
	rep, err := endpoint(ctx, request)
	if err != nil {
		return nil, statusx.From(err)
	}
	return rep.(*UpdateUserResponse), nil
}
func (c *cQRSClientService) FindUser(ctx context.Context, request *FindUserRequest) (*GetUserResponse, error) {
	ctx = endpointx.InjectName(ctx, "/pb.CQRS/FindUser")
	ctx = transportx.InjectName(ctx, c.transportName)
	endpoint, err := c.endpoints.FindUser(ctx)
	if err != nil {
		return nil, err
	}
	rep, err := endpoint(ctx, request)
	if err != nil {
		return nil, statusx.From(err)
	}
	return rep.(*GetUserResponse), nil
}
func newCQRSClientService(endpoints CQRSClientEndpoints, transportName string) CQRSService {
	return &cQRSClientService{endpoints: endpoints, transportName: transportName}
}
